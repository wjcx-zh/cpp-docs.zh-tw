---
title: CRowset 類別
ms.date: 11/04/2016
f1_keywords:
- ATL.CRowset<TAccessor>
- CRowset
- ATL::CRowset
- ATL::CRowset<TAccessor>
- ATL.CRowset
- CRowset<TAccessor>.AddRefRows
- CRowset.AddRefRows
- ATL.CRowset.AddRefRows
- AddRefRows
- CRowset::AddRefRows
- CRowset<TAccessor>::AddRefRows
- ATL::CRowset::AddRefRows
- ATL.CRowset<TAccessor>.AddRefRows
- ATL::CRowset<TAccessor>::AddRefRows
- CRowset::Close
- ATL.CRowset.Close
- CRowset<TAccessor>::Close
- CRowset<TAccessor>.Close
- ATL.CRowset<TAccessor>.Close
- ATL::CRowset::Close
- ATL::CRowset<TAccessor>::Close
- CRowset.Close
- CRowset<TAccessor>.Compare
- CRowset<TAccessor>::Compare
- ATL.CRowset<TAccessor>.Compare
- ATL::CRowset<TAccessor>::Compare
- CRowset.Compare
- ATL::CRowset::Compare
- ATL.CRowset.Compare
- CRowset::Compare
- CRowset<TAccessor>::CRowset
- CRowset.CRowset
- ATL::CRowset::CRowset
- ATL::CRowset<TAccessor>::CRowset
- ATL.CRowset.CRowset
- CRowset<TAccessor>.CRowset
- CRowset::CRowset
- ATL.CRowset<TAccessor>.CRowset
- ATL::CRowset::Delete
- CRowset.Delete
- CRowset::Delete
- ATL.CRowset.Delete
- ATL::CRowset<TAccessor>::Delete
- CRowset<TAccessor>.Delete
- CRowset<TAccessor>::Delete
- ATL.CRowset<TAccessor>.Delete
- ATL.CRowset.FindNextRow
- CRowset<TAccessor>.FindNextRow
- ATL::CRowset::FindNextRow
- CRowset::FindNextRow
- CRowset<TAccessor>::FindNextRow
- CRowset.FindNextRow
- ATL.CRowset<TAccessor>.FindNextRow
- ATL::CRowset<TAccessor>::FindNextRow
- FindNextRow
- ATL::CRowset::GetApproximatePosition
- ATL::CRowset<TAccessor>::GetApproximatePosition
- CRowset.GetApproximatePosition
- CRowset::GetApproximatePosition
- GetApproximatePosition
- ATL.CRowset.GetApproximatePosition
- CRowset<TAccessor>::GetApproximatePosition
- CRowset<TAccessor>::GetData
- ATL::CRowset<TAccessor>::GetData
- ATL::CRowset::GetData
- ATL.CRowset<TAccessor>.GetData
- CRowset<TAccessor>.GetData
- CRowset::GetData
- CRowset.GetData
- ATL.CRowset.GetData
- CRowset<TAccessor>::GetDataHere
- CRowset<TAccessor>.GetDataHere
- CRowset.GetDataHere
- GetDataHere
- CRowset::GetDataHere
- ATL::CRowset::GetDataHere
- ATL::CRowset<TAccessor>::GetDataHere
- ATL.CRowset<TAccessor>.GetDataHere
- ATL.CRowset.GetDataHere
- ATL.CRowset<TAccessor>.GetOriginalData
- CRowset<TAccessor>::GetOriginalData
- ATL::CRowset<TAccessor>::GetOriginalData
- ATL.CRowset.GetOriginalData
- CRowset::GetOriginalData
- ATL::CRowset::GetOriginalData
- CRowset.GetOriginalData
- CRowset.GetRowStatus
- ATL.CRowset<TAccessor>.GetRowStatus
- ATL::CRowset<TAccessor>::GetRowStatus
- CRowset::GetRowStatus
- ATL::CRowset::GetRowStatus
- CRowset<TAccessor>::GetRowStatus
- ATL.CRowset.GetRowStatus
- CRowset<TAccessor>.GetRowStatus
- ATL.CRowset<TAccessor>.Insert
- CRowset.Insert
- CRowset<TAccessor>.Insert
- CRowset<TAccessor>::Insert
- ATL::CRowset<TAccessor>::Insert
- ATL.CRowset.Insert
- CRowset::Insert
- ATL::CRowset::Insert
- CRowset::IsSameRow
- CRowset.IsSameRow
- ATL::CRowset::IsSameRow
- ATL.CRowset.IsSameRow
- CRowset<TAccessor>::IsSameRow
- ATL.CRowset<TAccessor>.IsSameRow
- CRowset<TAccessor>.IsSameRow
- ATL::CRowset<TAccessor>::IsSameRow
- CRowset<TAccessor>::MoveFirst
- ATL::CRowset::MoveFirst
- CRowset<TAccessor>.MoveFirst
- CRowset::MoveFirst
- CRowset.MoveFirst
- ATL.CRowset.MoveFirst
- ATL.CRowset<TAccessor>.MoveFirst
- ATL::CRowset<TAccessor>::MoveFirst
- ATL::CRowset<TAccessor>::MoveLast
- CRowset<TAccessor>::MoveLast
- ATL.CRowset.MoveLast
- ATL::CRowset::MoveLast
- CRowset<TAccessor>.MoveLast
- CRowset::MoveLast
- ATL.CRowset<TAccessor>.MoveLast
- CRowset.MoveLast
- ATL.CRowset<TAccessor>.MoveNext
- ATL.CRowset.MoveNext
- ATL::CRowset<TAccessor>::MoveNext
- CRowset<TAccessor>.MoveNext
- CRowset.MoveNext
- CRowset<TAccessor>::MoveNext
- CRowset::MoveNext
- ATL::CRowset::MoveNext
- CRowset<TAccessor>.MovePrev
- CRowset.MovePrev
- CRowset::MovePrev
- ATL.CRowset.MovePrev
- ATL::CRowset<TAccessor>::MovePrev
- ATL::CRowset::MovePrev
- ATL.CRowset<TAccessor>.MovePrev
- CRowset<TAccessor>::MovePrev
- ATL::CRowset::MoveToBookmark
- ATL::CRowset<TAccessor>::MoveToBookmark
- ATL.CRowset.MoveToBookmark
- ATL.CRowset<TAccessor>.MoveToBookmark
- CRowset::MoveToBookmark
- CRowset.MoveToBookmark
- CRowset<TAccessor>::MoveToBookmark
- CRowset<TAccessor>::MoveToRatio
- CRowset::MoveToRatio
- CRowset<TAccessor>.MoveToRatio
- ATL.CRowset.MoveToRatio
- ATL::CRowset::MoveToRatio
- CRowset.MoveToRatio
- ATL.CRowset<TAccessor>.MoveToRatio
- ATL::CRowset<TAccessor>::MoveToRatio
- CRowset::ReleaseRows
- ATL::CRowset<TAccessor>::ReleaseRows
- CRowset<TAccessor>.ReleaseRows
- CRowset.ReleaseRows
- ATL.CRowset.ReleaseRows
- ATL.CRowset<TAccessor>.ReleaseRows
- CRowset<TAccessor>::ReleaseRows
- ATL::CRowset::ReleaseRows
- ATL.CRowset<TAccessor>.SetData
- ATL::CRowset::SetData
- CRowset<TAccessor>.SetData
- CRowset::SetData
- ATL.CRowset.SetData
- CRowset.SetData
- CRowset<TAccessor>::SetData
- ATL::CRowset<TAccessor>::SetData
- CRowset.Undo
- ATL::CRowset<TAccessor>::Undo
- CRowset<TAccessor>::Undo
- ATL.CRowset.Undo
- ATL.CRowset<TAccessor>.Undo
- CRowset<TAccessor>.Undo
- ATL::CRowset::Undo
- CRowset::Undo
- Undo
- CRowset.Update
- ATL.CRowset.Update
- ATL.CRowset<TAccessor>.Update
- ATL::CRowset<TAccessor>::Update
- CRowset<TAccessor>::Update
- CRowset::Update
- CRowset<TAccessor>.Update
- ATL::CRowset::Update
- CRowset::UpdateAll
- ATL.CRowset.UpdateAll
- CRowset<TAccessor>.UpdateAll
- ATL.CRowset<TAccessor>.UpdateAll
- UpdateAll
- CRowset.UpdateAl
- ATL::CRowset<TAccessor>::UpdateAll
- CRowset<TAccessor>::UpdateAll
- ATL::CRowset::UpdateAll
helpviewer_keywords:
- CRowset class
- AddRefRows method
- Close method
- Compare method
- CRowset class, constructor
- Delete method
- FindNextRow method
- GetApproximatePosition method
- GetData method [OLE DB]
- GetDataHere method
- GetOriginalData method
- GetRowStatus method
- Insert method
- IsSameRow method
- MoveFirst method
- MoveLast method
- MoveNext method
- MovePrev method
- MoveToBookmark method
- MoveToRatio method
- ReleaseRows method
- SetData method
- Undo method
- Update method
- UpdateAll method
ms.assetid: b0228a90-b8dd-47cc-b397-8d4c15c1e7f4
ms.openlocfilehash: b351530326e0dc4ed0b72db50d17717824eb6bb4
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/29/2020
ms.locfileid: "91507278"
---
# <a name="crowset-class"></a>CRowset 類別

封裝 OLE DB 資料列集物件和數個相關的介面，並提供資料列集資料的操作方法。

## <a name="syntax"></a>語法

```cpp
template <class TAccessor = CAccessorBase>
class CRowset
```

### <a name="parameters"></a>參數

*TAccessor*<br/>
存取子類別。 預設值為 `CAccessorBase`。

## <a name="requirements"></a>需求

**標題:** atldbcli.h

## <a name="members"></a>成員

### <a name="methods"></a>方法

| 名稱 | 描述 |
|-|-|
|[AddRefRows](#addrefrows)|遞增與目前資料列相關聯的參考計數。|
|[關閉](#close)|釋放資料列和目前的 `IRowset` 介面。|
|[比較](#compare)|使用 [IRowsetLocate：： Compare](/previous-versions/windows/desktop/ms709539(v=vs.85))比較兩個書簽。|
|[CRowset](#crowset)|建立新的 `CRowset` 物件，並 (選擇性地) 將它與 `IRowset` 提供作為參數的介面產生關聯。|
|[刪除](#delete)|使用 [IRowsetChange： DeleteRows](/previous-versions/windows/desktop/ms724362(v=vs.85))從資料列集刪除資料列。|
|[FindNextRow](#findnextrow)|尋找指定書簽之後的下一個相符資料列。|
|[GetApproximatePosition](#getapproximateposition)|傳回對應至書簽的資料列近似位置。|
|[GetData](#getdata)|從資料列集的資料列複本擷取資料。|
|[GetDataHere](#getdatahere)|從指定的緩衝區抓取資料。|
|[GetOriginalData](#getoriginaldata)|抓取最近從資料來源提取或傳送到資料來源的資料，並忽略暫止的變更。|
|[GetRowStatus](#getrowstatus)|傳回所有資料列的狀態。|
|[插入](#insert)|使用 [IRowsetChange： InsertRow](/previous-versions/windows/desktop/ms716921(v=vs.85))建立並插入新的資料列。|
|[IsSameRow](#issamerow)|比較指定的資料列與目前的資料列。|
|[MoveFirst](#movefirst)|將下一個提取位置重新置放至初始位置。|
|[MoveLast](#movelast)|移至最後一筆記錄。|
|[MoveNext](#movenext)|從下一個連續資料列或在下一個資料列以外的指定數目位置提取資料。|
|[MovePrev](#moveprev)|移至先前的記錄。|
|[MoveToBookmark](#movetobookmark)|提取以書簽標記的資料列，或從該書簽指定之位移的資料列。|
|[MoveToRatio](#movetoratio)|從資料列集中的小數位置開始提取資料列。|
|[ReleaseRows](#releaserows)|呼叫 [IRowset：： ReleaseRows](/previous-versions/windows/desktop/ms719771(v=vs.85)) 釋放目前的資料列控制碼。|
|[SetData](#setdata)|使用 [IRowsetChange： SetData](/previous-versions/windows/desktop/ms721232(v=vs.85))，在資料列的一個或多個資料行中設定資料值。|
|[復原](#undo)|復原自上次提取或 [更新](#update)之後對資料列所做的任何變更。|
|[更新](#update)|在上次提取或更新之後，傳輸對目前資料列所做的任何暫止變更。|
|[UpdateAll](#updateall)|傳輸自上次提取或更新之後對所有資料列所做的任何暫止變更。|

## <a name="remarks"></a>備註

在 OLE DB 中，資料列集是程式用來設定和捕獲資料的物件。

這個類別不是要具現化，而是做為樣板參數傳遞至 `CTable` 或 `CCommand` (`CRowset` 是預設) 。

## <a name="crowsetaddrefrows"></a><a name="addrefrows"></a> CRowset：： AddRefRows

呼叫 [IRowset：： AddRefRows](/previous-versions/windows/desktop/ms719619(v=vs.85)) ，將 (遞增一個) 與目前資料列控制碼相關聯的參考計數。

### <a name="syntax"></a>語法

```cpp
HRESULT AddRefRows() throw();
```

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法會遞增目前資料列控制碼的參考計數。 呼叫 [ReleaseRows](#releaserows) 以遞減計數。 移動方法所傳回的資料列的參考計數為1。

## <a name="crowsetclose"></a><a name="close"></a> CRowset：： Close

釋放資料列和目前的 [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) 介面。

### <a name="syntax"></a>語法

```cpp
void Close() throw();
```

### <a name="remarks"></a>備註

這個方法會釋出目前在資料列集中的所有資料列。

## <a name="crowsetcompare"></a><a name="compare"></a> CRowset：： Compare

使用 [IRowsetLocate：： Compare](/previous-versions/windows/desktop/ms709539(v=vs.85))比較兩個書簽。

### <a name="syntax"></a>語法

```cpp
HRESULT Compare(const CBookmarkBase& bookmark1,
   const CBookmarkBase& bookmark2,
   DBCOMPARE* pComparison) const throw();
```

#### <a name="parameters"></a>參數

*Bookmark1*<br/>
在要比較的第一個書簽。

*Bookmark2*<br/>
在要比較的第二個書簽。

*pComparison*<br/>
擴展比較結果的指標。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法需要選用的介面 `IRowsetLocate` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetLocate` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

如需在取用者中使用書簽的詳細資訊，請參閱 [使用書簽](../../data/oledb/using-bookmarks.md)。

## <a name="crowsetcrowset"></a><a name="crowset"></a> CRowset：： CRowset

建立新的 `CRowset` 物件，並 (選擇性地) 將它與提供作為參數的 [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) 介面產生關聯。

### <a name="syntax"></a>語法

```cpp
CRowset();

CRowset(IRowset* pRowset);
```

#### <a name="parameters"></a>參數

*pRowset*<br/>
[in] 要與這個類別相關聯的 `IRowset` 介面指標。

## <a name="crowsetdelete"></a><a name="delete"></a> CRowset：:D elete

呼叫 [IRowsetChange：:D eleterows](/previous-versions/windows/desktop/ms724362(v=vs.85)) ，以從資料列集刪除目前的資料列。

### <a name="syntax"></a>語法

```cpp
HRESULT Delete() const throw();
```

### <a name="return-value"></a>傳回值

標準 HRESULT。

## <a name="crowsetfindnextrow"></a><a name="findnextrow"></a> CRowset：： FindNextRow

尋找指定書簽之後的下一個相符資料列。

### <a name="syntax"></a>語法

```cpp
HRESULT FindNextRow(DBCOMPAREOP op,
   BYTE* pData,
   DBTYPE wType,
   DBLENGTH nLength,
   BYTE bPrecision,
   BYTE bScale,
   BOOL bSkipCurrent = TRUE,
   CBookmarkBase* pBookmark = NULL) throw();
```

#### <a name="parameters"></a>參數

*主管*<br/>
在用於比較資料列值的作業。 如需值的詳細資料，請參閱 [IRowsetFind：： FindNextRow](/previous-versions/windows/desktop/ms723091(v=vs.85))。

*.Pdata*<br/>
在要比對之值的指標。

*wType*<br/>
在指出緩衝區值部分的資料類型。 如需類型指標的詳細資訊，請參閱 Windows SDK 中的 OLE DB 程式設計*人員參考*中的[資料類型](/previous-versions/windows/desktop/ms723969(v=vs.85))。

*nLength*<br/>
在配置給資料值之取用者資料結構的長度（以位元組為單位）。 如需詳細資訊，請參閱 `cbMaxLen` 《 OLE DB 程式設計*人員參考*》中的[DBBINDING 結構](/previous-versions/windows/desktop/ms716845(v=vs.85))描述。

*bPrecision*<br/>
在取得資料時所使用的最大有效位數。 只有在 DBTYPE_NUMERIC *wType* 時才會使用。 如需詳細資訊，請參閱 OLE DB 程式設計*人員參考*中[涉及 DBTYPE_NUMERIC 或 DBTYPE_DECIMAL 的轉換](/previous-versions/windows/desktop/ms719714(v=vs.85))。

*bScale*<br/>
在取得資料時所使用的小數位數。 只有在 *wType* 為 DBTYPE_NUMERIC 或 DBTYPE_DECIMAL 時才會使用。 如需詳細資訊，請參閱 OLE DB 程式設計*人員參考*中[涉及 DBTYPE_NUMERIC 或 DBTYPE_DECIMAL 的轉換](/previous-versions/windows/desktop/ms719714(v=vs.85))。

*bSkipCurrent*<br/>
在書簽中要開始搜尋的資料列數目。

*pBookmark*<br/>
在要開始搜尋之位置的書簽。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法需要選用的介面 `IRowsetFind` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetFind` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

如需在取用者中使用書簽的詳細資訊，請參閱 [使用書簽](../../data/oledb/using-bookmarks.md)。

## <a name="crowsetgetapproximateposition"></a><a name="getapproximateposition"></a> CRowset：： GetApproximatePosition

傳回對應至書簽的資料列近似位置。

### <a name="syntax"></a>語法

```cpp
HRESULT GetApproximatePosition(const CBookmarkBase* pBookmark,
   DBCOUNTITEM* pPosition,
   DBCOUNTITEM* pcRows) throw();
```

#### <a name="parameters"></a>參數

*pBookmark*<br/>
在書簽的指標，可識別要找到其位置的資料列。 如果只需要資料列計數，則為 Null。

*pPosition*<br/>
擴展位置的指標，傳回資料 `GetApproximatePosition` 列的位置。 如果不需要位置，則為 Null。

*pcRows*<br/>
擴展傳回資料 `GetApproximatePosition` 列總數之位置的指標。 如果不需要資料列計數，則為 Null。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法需要選用的介面 `IRowsetScroll` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetScroll` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

如需在取用者中使用書簽的詳細資訊，請參閱 [使用書簽](../../data/oledb/using-bookmarks.md)。

## <a name="crowsetgetdata"></a><a name="getdata"></a> CRowset：：：：的

從資料列集的資料列複本擷取資料。

### <a name="syntax"></a>語法

```cpp
HRESULT GetData() throw();

HRESULT GetData(int nAccessor) throw();
```

#### <a name="parameters"></a>參數

*nAccessor*<br/>
在用來存取資料之存取子的 (零位移) 索引編號。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

如果您指定的存取子不是 [BEGIN_ACCESSOR](./macros-and-global-functions-for-ole-db-consumer-templates.md#begin_accessor)中的 autoaccessor，請使用這個方法，藉由傳遞存取子編號來明確取得資料。

## <a name="crowsetgetdatahere"></a><a name="getdatahere"></a> CRowset：： GetDataHere

從目前的資料列取出資料，並將它放入指定的緩衝區。

### <a name="syntax"></a>語法

```cpp
HRESULT GetDataHere(int nAccessor,
   void* pBuffer) throw();
```

#### <a name="parameters"></a>參數

*nAccessor*<br/>
在用來存取資料之存取子的索引編號。

*pBuffer*<br/>
擴展要在其中放置目前記錄之資料的緩衝區。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

如需如何使用此函式的範例，請參閱 [MultiRead 範例](../../overview/visual-cpp-samples.md)。

## <a name="crowsetgetoriginaldata"></a><a name="getoriginaldata"></a> CRowset：： GetOriginalData

呼叫 `IRowsetUpdate::GetOriginalData` ，以取得最近從資料來源提取或傳送到資料來源的資料。

### <a name="syntax"></a>語法

```cpp
HRESULT GetOriginalData() throw();
```

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法會抓取最近從資料來源提取或傳送到資料來源的資料;它不會根據暫止的變更來取得值。

這個方法需要選用的介面 `IRowsetUpdate` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetUpdate` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

## <a name="crowsetgetrowstatus"></a><a name="getrowstatus"></a> CRowset：： GetRowStatus

傳回所有資料列的狀態。

### <a name="syntax"></a>語法

```cpp
HRESULT GetRowStatus(DBPENDINGSTATUS* pStatus) const throw();
```

#### <a name="parameters"></a>參數

*pStatus*<br/>
擴展傳回狀態值之位置的指標 `GetRowStatus` 。 請參閱 OLE DB 程式設計人員參考中的 DBPENDINGSTATUS。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法需要選用的介面 `IRowsetUpdate` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetUpdate` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

## <a name="crowsetinsert"></a><a name="insert"></a> CRowset：： Insert

使用存取子中的資料建立並初始化新的資料列。

### <a name="syntax"></a>語法

```cpp
HRESULT Insert(int nAccessor = 0,
   bool bGetHRow = false) throw();
```

#### <a name="parameters"></a>參數

*nAccessor*<br/>
在用於插入資料的存取子數目。

*bGetHRow*<br/>
在指出是否抓取插入之資料列的控制碼。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法需要選用的介面 `IRowsetChange` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetChange` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

如果有一或多個資料行無法寫入，插入可能會失敗。 請修改您的資料指標對應以修正這個問題。

### <a name="example"></a>範例

下列範例示範如何透過資料列集來存取資料來源，然後使用該資料列集中的資料表來插入字串。

首先，將新的 ATL 物件插入專案中，以建立資料表類別。 例如，在 [工作區] 窗格中的專案上按一下滑鼠右鍵，然後選取 [ **新增 ATL 物件**]。 從 [ **資料存取** ] 分類中，選取 [取用 **者**]。 建立類型為 **Table**的取用者物件。  (選取 **資料表** 時，會直接從資料表建立資料列集;選取 **命令** 可透過 SQL 命令建立資料列集。 ) 選取資料來源，並指定用來存取該資料來源的資料表。 如果您呼叫取用者物件 **CCustomerTable**，則會依照下列方式來執行您的插入程式碼：

[!code-cpp[NVC_OLEDB_Consumer#10](../../data/oledb/codesnippet/cpp/crowset-insert_1.cpp)]

## <a name="crowsetissamerow"></a><a name="issamerow"></a> CRowset：： IsSameRow

比較指定的資料列與目前的資料列。

### <a name="syntax"></a>語法

```cpp
HRESULT IsSameRow(HROW hRow) const throw();
```

#### <a name="parameters"></a>參數

*hRow*<br/>
在要與目前資料列比較的資料列控制碼。

### <a name="return-value"></a>傳回值

標準 HRESULT。 S_OK 指出資料列相同。 如需其他值，請參閱 Windows SDK 的 OLE DB 程式設計*人員參考*中的[IRowsetIndentity：： IsSameRow](/previous-versions/windows/desktop/ms719629(v=vs.85)) 。

## <a name="crowsetmovefirst"></a><a name="movefirst"></a> CRowset：： MoveFirst

將游標移至初始位置，並抓取初始資料列。

### <a name="syntax"></a>語法

```cpp
HRESULT MoveFirst() throw();
```

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

呼叫 [IRowset：： RestartPosition](/previous-versions/windows/desktop/ms712877(v=vs.85)) ，將下一個提取位置重新置放至初始位置， (在建立資料列集時為下一個提取位置的位置) 並抓取初始資料列。

## <a name="crowsetmovelast"></a><a name="movelast"></a> CRowset：： MoveLast

將游標移至最後一個資料列。

### <a name="syntax"></a>語法

```cpp
HRESULT MoveLast() throw();
```

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

呼叫 [IRowset：： RestartPosition](/previous-versions/windows/desktop/ms712877(v=vs.85)) ，將下一個提取位置重新置放到最後一個位置，並抓取最後一個資料列。

這個方法會要求您在 `DBPROP_CANSCROLLBACKWARDS` 包含資料列 `Open` 集的資料表或命令上呼叫之前，先將設定為 VARIANT_TRUE。  (若要獲得更好的效能，您也可以將設定 `DBPROP_QUICKRESTART` 為 VARIANT_TRUE。 ) 

## <a name="crowsetmovenext"></a><a name="movenext"></a> CRowset：： MoveNext

將游標移到下一筆記錄。

### <a name="syntax"></a>語法

```cpp
HRESULT MoveNext() throw();

HRESULT MoveNext(LONG lSkip,
   bool bForward= true) throw();
```

#### <a name="parameters"></a>參數

*lSkip*<br/>
在提取之前要跳過的資料列數目。

*bForward*<br/>
在傳遞 **`true`** 以向前移到下一筆記錄， **`false`** 以向後移動。

### <a name="return-value"></a>傳回值

標準 HRESULT。 到達資料列集的結尾時，會傳回 DB_S_ENDOFROWSET。

### <a name="remarks"></a>備註

從物件中提取下一個連續的資料列 `CRowset` ，並記住先前的位置。 （選擇性）您可以選擇略過 *lSkip* 資料列的向前或向後移動。

這個方法會要求您在包含資料列 `Open` 集的資料表或命令上呼叫之前，設定下列屬性：

- `DBPROP_CANSCROLLBACKWARDS` 如果 *lSkip* < 0，則必須 VARIANT_TRUE

- `DBPROP_CANFETCHBACKWARDS` 如果 *bForward* = false，則必須 VARIANT_TRUE

否則 (如果 *lSkip* >= 0 且 *bForward* = true) ，則不需要設定任何其他屬性。

## <a name="crowsetmoveprev"></a><a name="moveprev"></a> CRowset：： MovePrev

將游標移至先前的記錄。

### <a name="syntax"></a>語法

```cpp
HRESULT MovePrev() throw();
```

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法會要求您在包含資料列 `DBPROP_CANFETCHBACKWARDS` `DBPROP_CANSCROLLBACKWARDS` `Open` 集的資料表或命令上呼叫之前，先將或設定為 VARIANT_TRUE。

## <a name="crowsetmovetobookmark"></a><a name="movetobookmark"></a> CRowset：： MoveToBookmark

提取以書簽標記的資料列或指定位移的資料列 (從該書簽 *lSkip*) 。

### <a name="syntax"></a>語法

```cpp
HRESULT MoveToBookmark(const CBookmarkBase& bookmark,
   LONG lSkip = 0) throw();
```

#### <a name="parameters"></a>參數

*bookmark*<br/>
[in] 標記您要從中擷取資料之位置的書籤。

*lSkip*<br/>
[in] 從書籤到目標資料列的資料列計數。 如果 *lSkip* 為零，則第一個提取的資料列會是已加上書簽的資料列。 如果 *lSkip* 是1，則第一個提取的資料列是加上書簽的資料列後面的資料列。 如果 *lSkip* 為-1，則第一個提取的資料列是加上書簽的資料列之前的資料列。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法需要選用的介面 `IRowsetLocate` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 您也必須設定 `DBPROP_IRowsetLocate` 為 VARIANT_TRUE，並在 `DBPROP_CANFETCHBACKWARDS` 包含資料列 `Open` 集的資料表或命令上呼叫之前，設定為 VARIANT_TRUE。

如需在取用者中使用書簽的詳細資訊，請參閱 [使用書簽](../../data/oledb/using-bookmarks.md)。

## <a name="crowsetmovetoratio"></a><a name="movetoratio"></a> CRowset：： MoveToRatio

從資料列集中的小數位置開始提取資料列。

### <a name="syntax"></a>語法

```cpp
HRESULT MoveToRatio(DBCOUNTITEM nNumerator,
   DBCOUNTITEM nDenominator,bool bForward = true) throw();
```

#### <a name="parameters"></a>參數

*nNumerator*<br/>
在用來判斷從中提取資料之小數位置的分子。

*nDenominator*<br/>
在用來判斷從中提取資料之小數位置的分母。

*bForward*<br/>
在指出是否要向前或向後移動。 預設值為 forward。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

`MoveToRatio` 大約會根據下列公式提取資料列：

`(nNumerator *  RowsetSize ) / nDenominator`

其中 `RowsetSize` 是資料列集的大小，以資料列來測量。 此公式的精確度取決於特定的提供者。 如需詳細資訊，請參閱 [IRowsetScroll：： GetRowsAtRatio](/previous-versions/windows/desktop/ms709602(v=vs.85))。

這個方法需要選用的介面 `IRowsetScroll` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetScroll` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

## <a name="crowsetreleaserows"></a><a name="releaserows"></a> CRowset：： ReleaseRows

呼叫 [IRowset：： ReleaseRows](/previous-versions/windows/desktop/ms719771(v=vs.85)) 釋放目前的資料列控制碼。

### <a name="syntax"></a>語法

```cpp
HRESULT ReleaseRows() throw();
```

### <a name="return-value"></a>傳回值

標準 HRESULT。

## <a name="crowsetsetdata"></a><a name="setdata"></a> CRowset：： SetData

設定資料列的一或多個資料行中的資料值。

### <a name="syntax"></a>語法

```cpp
HRESULT SetData() const throw();

HRESULT SetData(int nAccessor) const throw();
```

#### <a name="parameters"></a>參數

*nAccessor*<br/>
在用來存取資料的存取子數目。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

若為 `SetData` 不接受引數的表單，則會使用所有存取子進行更新。 您通常會呼叫 `SetData` ，以在資料列的資料行中設定資料值，然後呼叫 [Update](#update) 來傳輸這些變更。

這個方法需要選用的介面 `IRowsetChange` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetChange` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

如果有一或多個資料行不可寫入，則設定作業可能會失敗。 請修改您的資料指標對應以修正這個問題。

## <a name="crowsetundo"></a><a name="undo"></a> CRowset：： Undo

復原自上次提取或 [更新](#update)之後對資料列所做的任何變更。

### <a name="syntax"></a>語法

```cpp
HRESULT Undo(DBCOUNTITEM* pcRows = NULL,
   HROW* phRow = NULL,
   DBROWSTATUS* pStatus = NULL) throw();
```

#### <a name="parameters"></a>參數

*pcRows*<br/>
擴展位置的指標，其中 `Undo` 會傳回它嘗試復原的資料列數目（如有需要）。

*phRow*<br/>
擴展位置的指標，其中 `Undo` 會將控制碼的陣列傳回至其嘗試復原的所有資料列（如有需要）。

*pStatus*<br/>
擴展傳回資料列狀態值之位置的指標 `Undo` 。 如果 *pStatus* 為 null，則不會傳回任何狀態。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

這個方法需要選用的介面 `IRowsetUpdate` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetUpdate` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

## <a name="crowsetupdate"></a><a name="update"></a> CRowset：： Update

傳送自上次提取或呼叫之後，對目前資料列所做的任何暫止變更 `Update` 。

### <a name="syntax"></a>語法

```cpp
HRESULT Update(DBCOUNTITEM* pcRows = NULL,
   HROW* phRow = NULL,
   DBROWSTATUS* pStatus = NULL) throw();
```

#### <a name="parameters"></a>參數

*pcRows*<br/>
擴展位置的指標 `Update` ，其中會傳回它嘗試更新的資料列數目（如有需要）。

*phRow*<br/>
擴展位置的指標，其中 `Update` 會傳回它嘗試更新之資料列的控制碼。 如果 *phRow* 為 null，則不會傳回任何控制碼。

*pStatus*<br/>
擴展傳回資料列狀態值之位置的指標 `Update` 。 如果 *pStatus* 為 null，則不會傳回任何狀態。

### <a name="return-value"></a>傳回值

標準 HRESULT。

### <a name="remarks"></a>備註

傳送對目前資料列所做的任何暫止變更，因為該資料列上次被提取或更新 (使用 `Update` 或 [UpdateAll](#updateall)) 。 您通常會呼叫 [SetData](#setdata) 來設定資料列中資料行的資料值，然後呼叫 `Update` 以傳送這些變更。

這個方法需要選用的介面 `IRowsetUpdate` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetUpdate` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

## <a name="crowsetupdateall"></a><a name="updateall"></a> CRowset：： UpdateAll

傳送自上次提取或呼叫之後，對所有資料列所做的任何暫止變更 `Update` 。

### <a name="syntax"></a>語法

```cpp
HRESULT UpdateAll(DBCOUNTITEM* pcRows = NULL,
   HROW** pphRow = NULL,
   DBROWSTATUS** ppStatus = NULL) throw();
```

#### <a name="parameters"></a>參數

*pcRows*<br/>
擴展位置的指標 `UpdateAll` ，其中會傳回它嘗試更新的資料列數目（如有需要）。

*pphRow*<br/>
擴展記憶體的指標，會傳回 `UpdateAll` 它嘗試更新之資料列的控制碼。 如果 *pphRow* 為 null，則不會傳回任何控制碼。

*ppStatus*<br/>
擴展傳回資料列狀態值之位置的指標 `Update` 。 如果 *ppStatus* 為 null，則不會傳回任何狀態。

### <a name="remarks"></a>備註

傳送對所有資料列所做的任何暫止變更，因為上次使用 [Update](#update) 或更新這些資料列的資料列 `UpdateAll` 。 `UpdateAll` 將會更新每個已修改的資料列，不論您是否仍有其控制碼 (請參閱 *pphRow*) 。

例如，如果您用 `Insert` 來在資料列集中插入五個數據列，您可以呼叫 `Update` 五次或呼叫 `UpdateAll` 一次，以將它們全部更新。

這個方法需要選用的介面 `IRowsetUpdate` ，在所有提供者上可能都不支援; 如果是這種情況，則方法會傳回 E_NOINTERFACE。 在包含資料列 `DBPROP_IRowsetUpdate` `Open` 集的資料表或命令上呼叫之前，您也必須設定為 VARIANT_TRUE。

### <a name="return-value"></a>傳回值

標準 HRESULT。

## <a name="see-also"></a>另請參閱

[DBViewer 範例](../../overview/visual-cpp-samples.md)<br/>
[MultiRead 範例](../../overview/visual-cpp-samples.md)<br/>
[MultiRead 屬性範例](../../overview/visual-cpp-samples.md)<br/>
[OLE DB 消費者範本](../../data/oledb/ole-db-consumer-templates-cpp.md)<br/>
[OLE DB 取用者範本參考](../../data/oledb/ole-db-consumer-templates-reference.md)
